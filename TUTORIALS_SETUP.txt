====================================================
TUTORIALS & SUBSCRIPTION MODULE - SETUP GUIDE
====================================================

This guide explains how to set up and use the new Tutorials & Subscription module for My Little Thingz.

====================================================
WHAT'S INCLUDED
====================================================

Frontend Components:
- TutorialsDashboard.jsx: Main tutorials listing page with payment modal
- TutorialViewer.jsx: Tutorial video player with access control
- Updated Index.jsx: Home page with "Study Tutorials" button in the Services section

Frontend Styles:
- tutorials.css: Styling for TutorialsDashboard
- tutorial-viewer.css: Styling for TutorialViewer
- Updated index.css: Styling for the tutorials CTA section

Backend API Endpoints:
- tutorials.php: Fetch all available tutorials
- tutorial-purchases.php: Fetch user's purchased tutorials
- purchase-tutorial.php: Handle tutorial purchases (Razorpay integration)
- tutorial-detail.php: Fetch single tutorial details
- check-tutorial-access.php: Check if user has access to a tutorial
- tutorial-razorpay-verify.php: Verify Razorpay payments for tutorials

Database:
- Migration script: backend/migrate_tutorials.php

====================================================
DATABASE SETUP
====================================================

To set up the required database tables:

1. Open your browser and go to:
   http://localhost/phpmyadmin/ (or your MySQL admin interface)

2. Run the migration by visiting:
   http://localhost/my_little_thingz/backend/migrate_tutorials.php

3. OR manually run these SQL commands:

   CREATE TABLE tutorials (
     id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
     title VARCHAR(255) NOT NULL,
     description TEXT,
     thumbnail_url VARCHAR(255),
     video_url VARCHAR(255) NOT NULL,
     duration INT,
     difficulty_level ENUM('beginner', 'intermediate', 'advanced') DEFAULT 'beginner',
     price DECIMAL(10, 2) DEFAULT 0,
     is_free BOOLEAN DEFAULT 0,
     category VARCHAR(100),
     created_by INT UNSIGNED,
     created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
     updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
     is_active BOOLEAN DEFAULT 1,
     INDEX idx_active (is_active),
     INDEX idx_category (category)
   );

   CREATE TABLE tutorial_purchases (
     id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
     user_id INT UNSIGNED NOT NULL,
     tutorial_id INT UNSIGNED NOT NULL,
     purchase_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
     expiry_date DATETIME,
     payment_method VARCHAR(50),
     razorpay_order_id VARCHAR(100),
     razorpay_payment_id VARCHAR(100),
     payment_status ENUM('pending', 'completed', 'failed') DEFAULT 'completed',
     amount_paid DECIMAL(10, 2),
     UNIQUE KEY unique_purchase (user_id, tutorial_id),
     FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
     FOREIGN KEY (tutorial_id) REFERENCES tutorials(id) ON DELETE CASCADE,
     INDEX idx_user (user_id),
     INDEX idx_tutorial (tutorial_id),
     INDEX idx_status (payment_status)
   );

====================================================
FLOW DESCRIPTION
====================================================

1. HOME PAGE:
   - User sees "Study Tutorials" button in the Services section
   - Button links to /tutorials route

2. AUTHENTICATION CHECK:
   - If NOT logged in: Redirects to /login
   - If logged in: Proceeds to tutorials dashboard

3. TUTORIALS DASHBOARD (/tutorials):
   - Shows grid of available tutorials
   - Each tutorial card displays:
     * Thumbnail image
     * Title and description
     * Duration and difficulty level
     * Price (if paid)
     * Status (Purchased/Free/Price)
   - Free tutorials show "Watch Now" button
   - Purchased tutorials show "Watch Now" with checkmark
   - Unpaid tutorials show "Purchase" button with price

4. PAYMENT MODAL:
   - Clicking "Purchase" opens a payment modal
   - Offers two payment methods:
     * Razorpay (card/UPI payment)
     * Subscription (placeholder for future implementation)
   - After successful payment, tutorial is immediately accessible

5. TUTORIAL VIEWER (/tutorial/:id):
   - Full-screen video player with embedded iframe
   - Shows tutorial metadata (duration, level, category)
   - Displays tutorial description and resources
   - Only accessible if:
     * Tutorial is free, OR
     * User has purchased the tutorial

====================================================
ADDING NEW TUTORIALS
====================================================

To add new tutorials to the database:

1. Using Admin Panel (Recommended):
   - Create admin API endpoint: backend/api/admin/tutorials.php
   - Add tutorials through admin dashboard

2. Direct Database Insert:
   INSERT INTO tutorials (title, description, video_url, thumbnail_url, duration, difficulty_level, price, is_free, category, is_active)
   VALUES (
     'Tutorial Title',
     'Tutorial description...',
     'https://youtube.com/embed/VIDEO_ID',
     'https://image-url.com/thumbnail.jpg',
     30,
     'beginner',
     199.00,
     0,
     'Category Name',
     1
   );

3. Using PHP Script:
   - Update migrate_tutorials.php with new tutorials
   - Run the migration

====================================================
CONFIGURATION NOTES
====================================================

Razorpay Integration:
- Make sure RAZORPAY_KEY and RAZORPAY_SECRET are set in backend/config/razorpay-config.php
- The purchase-tutorial.php endpoint uses these credentials

Payment Methods:
- Current: Razorpay (implemented)
- Future: Subscription model (placeholder ready)
- Free tutorials: No payment required

Video Hosting:
- Videos can be hosted on:
  * YouTube (embed via iframe)
  * Vimeo (embed via iframe)
  * Your own server (direct MP4 links)
- Update video_url field with appropriate embed URL

====================================================
API ENDPOINTS REFERENCE
====================================================

GET /backend/api/customer/tutorials.php
  - Fetches all active tutorials
  - Requires: None (public)
  - Returns: List of tutorials

GET /backend/api/customer/tutorial-purchases.php
  - Fetches user's purchased tutorials
  - Requires: X-User-ID header
  - Returns: User's purchase history

GET /backend/api/customer/tutorial-detail.php?id=ID
  - Fetches details of single tutorial
  - Requires: None (public)
  - Returns: Tutorial details

GET /backend/api/customer/check-tutorial-access.php?tutorial_id=ID
  - Checks if user has access to tutorial
  - Requires: X-User-ID header
  - Returns: Access status (true/false)

POST /backend/api/customer/purchase-tutorial.php
  - Initiates tutorial purchase
  - Requires: X-User-ID header, tutorial_id, payment_method
  - Returns: Razorpay order details or success message

POST /backend/api/customer/tutorial-razorpay-verify.php
  - Verifies Razorpay payment
  - Requires: X-User-ID header, razorpay_payment_id, razorpay_order_id, razorpay_signature
  - Returns: Payment verification result

====================================================
TROUBLESHOOTING
====================================================

1. "Study Tutorials" button doesn't appear:
   - Clear browser cache
   - Restart development server (npm run dev)
   - Check that Index.jsx was properly updated

2. Payment modal won't open:
   - Verify Razorpay credentials are set
   - Check browser console for JavaScript errors
   - Ensure payment method is 'razorpay'

3. Access denied to tutorial after purchase:
   - Check tutorial_purchases table has entry with payment_status='completed'
   - Verify X-User-ID header is being sent correctly
   - Clear browser cache and log in again

4. Tutorial video not loading:
   - Verify video_url is a valid embed URL
   - For YouTube: Use https://www.youtube.com/embed/VIDEO_ID format
   - Check CORS headers are allowed

====================================================
FUTURE ENHANCEMENTS
====================================================

1. Subscription Model:
   - Monthly/yearly subscription plans
   - Unlimited tutorial access
   - Auto-renewal and cancellation

2. Admin Dashboard:
   - Create/edit/delete tutorials
   - Manage tutorial categories
   - View sales and analytics

3. Tutorial Analytics:
   - Track video completion rates
   - User engagement metrics
   - Popular tutorials dashboard

4. Certificate System:
   - Generate certificates upon tutorial completion
   - Email delivery of certificates
   - Share on social media

5. Community Features:
   - Comments on tutorials
   - Ratings and reviews
   - Discussion forums

====================================================
END OF SETUP GUIDE
====================================================

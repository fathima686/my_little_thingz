<!DOCTYPE html>
<html>
<head>
    <title>Live Sessions Frontend Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .response { background: #f5f5f5; padding: 10px; margin: 10px 0; white-space: pre-wrap; border-radius: 3px; }
        .error { background: #ffe6e6; color: #d00; }
        .success { background: #e6ffe6; color: #060; }
        .warning { background: #fff3cd; color: #856404; }
        button { background: #007cba; color: white; padding: 8px 15px; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #005a87; }
        .session-card { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .status-scheduled { background: #e3f2fd; }
        .status-live { background: #e8f5e8; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Live Sessions Frontend Test</h1>
        <p>This page tests the live sessions functionality that your React component uses.</p>
        
        <div class="test-section">
            <h3>Step 1: Test Database Setup</h3>
            <button onclick="runDatabaseSetup()">Run Database Setup</button>
            <div id="setup-result" class="response"></div>
        </div>
        
        <div class="test-section">
            <h3>Step 2: Test Live Subjects API</h3>
            <button onclick="testSubjectsAPI()">Test Subjects</button>
            <div id="subjects-result" class="response"></div>
        </div>
        
        <div class="test-section">
            <h3>Step 3: Test Live Sessions API</h3>
            <button onclick="testSessionsAPI()">Test Sessions</button>
            <div id="sessions-result" class="response"></div>
        </div>
        
        <div class="test-section">
            <h3>Step 4: Display Live Sessions</h3>
            <button onclick="displaySessions()">Load & Display Sessions</button>
            <div id="sessions-display"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost/my_little_thingz/backend/api';
        
        async function runDatabaseSetup() {
            const resultDiv = document.getElementById('setup-result');
            resultDiv.textContent = 'Running database setup...';
            resultDiv.className = 'response';
            
            try {
                const response = await fetch('http://localhost/my_little_thingz/backend/fix-live-sessions-complete.php');
                const text = await response.text();
                
                if (response.ok) {
                    resultDiv.className = 'response success';
                    resultDiv.innerHTML = text;
                } else {
                    resultDiv.className = 'response error';
                    resultDiv.textContent = `Setup failed: ${response.status} ${response.statusText}`;
                }
            } catch (error) {
                resultDiv.className = 'response error';
                resultDiv.textContent = `Setup error: ${error.message}`;
            }
        }
        
        async function testSubjectsAPI() {
            const resultDiv = document.getElementById('subjects-result');
            resultDiv.textContent = 'Testing subjects API...';
            resultDiv.className = 'response';
            
            try {
                const response = await fetch(`${API_BASE}/customer/live-subjects.php`);
                const text = await response.text();
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = JSON.parse(text);
                
                if (data.status === 'success') {
                    resultDiv.className = 'response success';
                    resultDiv.textContent = `✓ Success! Found ${data.subjects.length} subjects:\n${JSON.stringify(data.subjects, null, 2)}`;
                } else {
                    resultDiv.className = 'response error';
                    resultDiv.textContent = `✗ API Error: ${data.message}`;
                }
            } catch (error) {
                resultDiv.className = 'response error';
                resultDiv.textContent = `✗ Error: ${error.message}`;
            }
        }
        
        async function testSessionsAPI() {
            const resultDiv = document.getElementById('sessions-result');
            resultDiv.textContent = 'Testing sessions API...';
            resultDiv.className = 'response';
            
            try {
                const response = await fetch(`${API_BASE}/customer/live-sessions.php`, {
                    headers: {
                        'X-User-ID': '1',
                        'Content-Type': 'application/json'
                    }
                });
                
                const text = await response.text();
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = JSON.parse(text);
                
                if (data.status === 'success') {
                    resultDiv.className = 'response success';
                    resultDiv.textContent = `✓ Success! Found ${data.sessions.length} sessions:\n${JSON.stringify(data.sessions, null, 2)}`;
                } else {
                    resultDiv.className = 'response error';
                    resultDiv.textContent = `✗ API Error: ${data.message}`;
                }
            } catch (error) {
                resultDiv.className = 'response error';
                resultDiv.textContent = `✗ Error: ${error.message}`;
            }
        }
        
        async function displaySessions() {
            const displayDiv = document.getElementById('sessions-display');
            displayDiv.innerHTML = '<p>Loading sessions...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/customer/live-sessions.php`, {
                    headers: {
                        'X-User-ID': '1',
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const text = await response.text();
                const data = JSON.parse(text);
                
                if (data.status === 'success' && data.sessions.length > 0) {
                    let html = '<h4>Live Sessions:</h4>';
                    
                    data.sessions.forEach(session => {
                        const datetime = new Date(`${session.scheduled_date}T${session.scheduled_time}`);
                        const formattedDate = datetime.toLocaleString();
                        
                        html += `
                            <div class="session-card status-${session.status}">
                                <h5>${session.title}</h5>
                                <p><strong>Subject:</strong> ${session.subject_name}</p>
                                <p><strong>Description:</strong> ${session.description}</p>
                                <p><strong>Date & Time:</strong> ${formattedDate}</p>
                                <p><strong>Duration:</strong> ${session.duration_minutes} minutes</p>
                                <p><strong>Status:</strong> ${session.status}</p>
                                <p><strong>Participants:</strong> ${session.registered_count}/${session.max_participants}</p>
                            </div>
                        `;
                    });
                    
                    displayDiv.innerHTML = html;
                } else if (data.status === 'success') {
                    displayDiv.innerHTML = '<p class="warning">No live sessions found. Run the database setup first.</p>';
                } else {
                    displayDiv.innerHTML = `<p class="error">Error: ${data.message}</p>`;
                }
            } catch (error) {
                displayDiv.innerHTML = `<p class="error">Error loading sessions: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
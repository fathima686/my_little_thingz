<!DOCTYPE html>
<html>
<head>
    <title>Test React Integration - Pro Access</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .api-test { margin: 15px 0; padding: 15px; border: 1px solid #dee2e6; border-radius: 8px; }
        .success { border-color: #28a745; background: #f8fff9; }
        .error { border-color: #dc3545; background: #fff8f8; }
        .warning { border-color: #ffc107; background: #fffdf5; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1>üß™ React Integration Test</h1>
        <p class="text-muted">Testing APIs that your React components use</p>
        
        <div class="row mb-4">
            <div class="col-md-6">
                <label class="form-label">Test Email:</label>
                <input type="email" class="form-control" id="testEmail" value="soudhame52@gmail.com">
            </div>
            <div class="col-md-6">
                <label class="form-label">&nbsp;</label>
                <button class="btn btn-primary d-block w-100" onclick="runAllTests()">üöÄ Run All API Tests</button>
            </div>
        </div>
        
        <div id="testResults"></div>
        
        <div class="mt-4">
            <h3>üéØ What This Tests</h3>
            <div class="alert alert-info">
                <p><strong>This simulates exactly what your React components do:</strong></p>
                <ul>
                    <li><strong>ProfileDropdown.jsx</strong> - Calls profile API to get user info</li>
                    <li><strong>Live Classes Component</strong> - Calls live workshops API to check access</li>
                    <li><strong>Subscription Components</strong> - Check subscription status</li>
                    <li><strong>Tutorial Components</strong> - Verify Pro access to content</li>
                </ul>
                <p class="mb-0">If all tests pass, your React app should work correctly!</p>
            </div>
        </div>
    </div>

    <script>
    async function runAllTests() {
        const email = document.getElementById('testEmail').value;
        const resultsDiv = document.getElementById('testResults');
        
        resultsDiv.innerHTML = '<div class="alert alert-info">üß™ Running API tests...</div>';
        
        const tests = [
            {
                name: 'Profile API (ProfileDropdown.jsx)',
                url: '/my_little_thingz/backend/api/customer/profile.php',
                headers: { 'X-Tutorial-Email': email },
                expectedFields: ['subscription', 'stats'],
                checkPro: (data) => data.subscription && data.subscription.plan_code === 'pro'
            },
            {
                name: 'Live Workshops API (Live Classes)',
                url: '/my_little_thingz/backend/api/customer/live-workshops.php',
                headers: { 'X-Tutorial-Email': email },
                expectedFields: ['workshops', 'access_level'],
                checkPro: (data) => data.access_level === 'pro'
            },
            {
                name: 'Subscription Status API',
                url: '/my_little_thingz/backend/api/customer/subscription-status.php?email=' + email,
                headers: {},
                expectedFields: ['subscription'],
                checkPro: (data) => data.subscription && data.subscription.plan_code === 'pro'
            },
            {
                name: 'Tutorials API (with Pro access)',
                url: '/my_little_thingz/backend/api/customer/tutorials.php',
                headers: { 'X-Tutorial-Email': email },
                expectedFields: ['tutorials'],
                checkPro: (data) => data.tutorials && data.tutorials.some(t => t.access_type === 'SUBSCRIPTION')
            }
        ];
        
        let results = [];
        
        for (const test of tests) {
            try {
                const response = await fetch(test.url, {
                    method: 'GET',
                    headers: test.headers
                });
                
                let data;
                const contentType = response.headers.get('content-type');
                
                if (contentType && contentType.includes('application/json')) {
                    data = await response.json();
                } else {
                    const text = await response.text();
                    throw new Error(`Non-JSON response: ${text.substring(0, 100)}...`);
                }
                
                const success = response.ok && data.status === 'success';
                const hasExpectedFields = test.expectedFields.every(field => data.hasOwnProperty(field));
                const isProDetected = success && hasExpectedFields ? test.checkPro(data) : false;
                
                results.push({
                    name: test.name,
                    success: success,
                    hasExpectedFields: hasExpectedFields,
                    isProDetected: isProDetected,
                    status: response.status,
                    data: data
                });
                
            } catch (error) {
                results.push({
                    name: test.name,
                    success: false,
                    hasExpectedFields: false,
                    isProDetected: false,
                    status: 0,
                    error: error.message
                });
            }
        }
        
        displayResults(results);
    }
    
    function displayResults(results) {
        const resultsDiv = document.getElementById('testResults');
        
        const successCount = results.filter(r => r.success).length;
        const proDetectedCount = results.filter(r => r.isProDetected).length;
        const totalCount = results.length;
        
        let html = `
            <div class="alert alert-${successCount === totalCount ? 'success' : 'warning'}">
                <h5>üìä Test Results Summary</h5>
                <p><strong>APIs Working:</strong> ${successCount}/${totalCount}</p>
                <p><strong>Pro Access Detected:</strong> ${proDetectedCount}/${totalCount}</p>
            </div>
        `;
        
        results.forEach(result => {
            const cssClass = result.success ? 'success' : 'error';
            const icon = result.success ? '‚úÖ' : '‚ùå';
            const proIcon = result.isProDetected ? 'üéØ Pro Detected' : '‚ö†Ô∏è Pro Not Detected';
            
            html += `
                <div class="api-test ${cssClass}">
                    <h6>${icon} ${result.name}</h6>
                    <p><strong>Status:</strong> ${result.status} | <strong>Success:</strong> ${result.success}</p>
                    ${result.success ? `<p><strong>Pro Access:</strong> ${proIcon}</p>` : ''}
                    ${result.error ? `<p class="text-danger"><strong>Error:</strong> ${result.error}</p>` : ''}
                    
                    <details>
                        <summary>View Response Data</summary>
                        <pre>${JSON.stringify(result.data || {}, null, 2)}</pre>
                    </details>
                </div>
            `;
        });
        
        // Add recommendations
        if (successCount === totalCount && proDetectedCount === totalCount) {
            html += `
                <div class="alert alert-success">
                    <h5>üéâ All Tests Passed!</h5>
                    <p><strong>Your React app should now work correctly:</strong></p>
                    <ul>
                        <li>‚úÖ ProfileDropdown will load without 500 errors</li>
                        <li>‚úÖ Live Classes section will show "Pro" access</li>
                        <li>‚úÖ All Pro features will be accessible</li>
                        <li>‚úÖ No more "upgrade to Pro" messages</li>
                    </ul>
                    <p class="mb-0"><strong>üöÄ Go refresh your React app and test it!</strong></p>
                </div>
            `;
        } else {
            html += `
                <div class="alert alert-warning">
                    <h5>‚ö†Ô∏è Some Issues Found</h5>
                    <p><strong>Recommendations:</strong></p>
                    <ul>
                        ${successCount < totalCount ? '<li>‚ùå Some APIs are failing - run the emergency fix script</li>' : ''}
                        ${proDetectedCount < totalCount ? '<li>üéØ Pro access not detected - check subscription status</li>' : ''}
                    </ul>
                    <p class="mb-0">
                        <a href="/my_little_thingz/backend/emergency-fix-pro-access.php" class="btn btn-warning">
                            üîß Run Emergency Fix
                        </a>
                    </p>
                </div>
            `;
        }
        
        resultsDiv.innerHTML = html;
    }
    
    // Auto-run tests on page load
    window.addEventListener('load', () => {
        runAllTests();
    });
    </script>
</body>
</html>
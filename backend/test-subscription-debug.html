<!DOCTYPE html>
<html>
<head>
    <title>Subscription Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-box { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e9; color: #2e7d32; }
        input, button { padding: 8px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Subscription Debug Tool</h1>
    
    <div>
        <label>Email:</label>
        <input type="email" id="email" placeholder="Enter your email">
        <button onclick="checkSubscription()">Check Subscription</button>
    </div>
    
    <div id="results"></div>
    
    <script>
        async function checkSubscription() {
            const email = document.getElementById('email').value;
            if (!email) {
                alert('Please enter an email');
                return;
            }
            
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="debug-box">Loading...</div>';
            
            try {
                // Check subscription status
                const subRes = await fetch(`api/customer/subscription-status.php`, {
                    headers: {
                        'X-Tutorial-Email': email
                    }
                });
                const subData = await subRes.json();
                
                // Check debug endpoint
                const debugRes = await fetch(`debug-subscription.php?email=${encodeURIComponent(email)}`);
                const debugData = await debugRes.json();
                
                // Check tutorial access for a sample tutorial
                const accessRes = await fetch(`api/customer/check-tutorial-access.php?tutorial_id=1&email=${encodeURIComponent(email)}`);
                const accessData = await accessRes.json();
                
                resultsDiv.innerHTML = `
                    <div class="debug-box">
                        <h3>Subscription Status API Response:</h3>
                        <pre>${JSON.stringify(subData, null, 2)}</pre>
                    </div>
                    
                    <div class="debug-box">
                        <h3>Debug Subscription Data:</h3>
                        <pre>${JSON.stringify(debugData, null, 2)}</pre>
                    </div>
                    
                    <div class="debug-box">
                        <h3>Tutorial Access Check (Tutorial ID 1):</h3>
                        <pre>${JSON.stringify(accessData, null, 2)}</pre>
                    </div>
                    
                    <div class="debug-box ${subData.is_active && (subData.plan_code === 'premium' || subData.plan_code === 'pro') ? 'success' : 'error'}">
                        <h3>Premium Access Status:</h3>
                        ${subData.is_active && (subData.plan_code === 'premium' || subData.plan_code === 'pro') 
                            ? '✅ You should have access to all premium videos' 
                            : '❌ No premium access detected'}
                    </div>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="debug-box error">Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
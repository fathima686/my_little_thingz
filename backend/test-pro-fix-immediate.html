<!DOCTYPE html>
<html>
<head>
    <title>Test Pro Fix Immediate</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .btn { background: #6b46c1; color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; margin: 10px 5px; }
        .btn:hover { background: #553c9a; }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .info { color: #3b82f6; }
        .result { background: #f8f9fa; padding: 15px; border-radius: 4px; margin: 15px 0; }
        .status-box { padding: 15px; border-radius: 5px; margin: 15px 0; }
        .status-success { background: #d1fae5; border: 1px solid #10b981; }
        .status-error { background: #fee2e2; border: 1px solid #ef4444; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Test Pro Fix Immediate</h1>
        <p>Quick test to verify Pro subscription is working for <strong>soudhame52@gmail.com</strong></p>
        
        <button class="btn" onclick="runFix()">1. Run Complete Fix</button>
        <button class="btn" onclick="testProStatus()">2. Test Pro Status</button>
        <button class="btn" onclick="testTutorialAccess()">3. Test Tutorial Access</button>
        
        <div id="status" class="status-box" style="display: none;"></div>
        <div id="result" class="result" style="display: none;"></div>
        
        <script>
        const API_BASE = 'http://localhost/my_little_thingz/backend/api';
        const userEmail = 'soudhame52@gmail.com';
        
        async function runFix() {
            const statusDiv = document.getElementById('status');
            const resultDiv = document.getElementById('result');
            
            statusDiv.innerHTML = 'üîß Running complete Pro subscription fix...';
            statusDiv.className = 'status-box status-error';
            statusDiv.style.display = 'block';
            resultDiv.style.display = 'none';
            
            try {
                const response = await fetch('force-pro-subscription-complete.php');
                const html = await response.text();
                
                if (response.ok) {
                    statusDiv.innerHTML = '‚úÖ Fix completed successfully!';
                    statusDiv.className = 'status-box status-success';
                    resultDiv.innerHTML = html;
                    resultDiv.style.display = 'block';
                } else {
                    statusDiv.innerHTML = '‚ùå Fix failed!';
                    statusDiv.className = 'status-box status-error';
                    resultDiv.innerHTML = html;
                    resultDiv.style.display = 'block';
                }
            } catch (error) {
                statusDiv.innerHTML = '‚ùå Network error: ' + error.message;
                statusDiv.className = 'status-box status-error';
            }
        }
        
        async function testProStatus() {
            const statusDiv = document.getElementById('status');
            const resultDiv = document.getElementById('result');
            
            statusDiv.innerHTML = 'üîç Testing Pro subscription status...';
            statusDiv.className = 'status-box status-error';
            statusDiv.style.display = 'block';
            
            try {
                // Add cache buster to avoid cached responses
                const cacheBuster = '?cb=' + Date.now();
                const response = await fetch(`${API_BASE}/customer/profile.php${cacheBuster}`, {
                    method: 'GET',
                    headers: {
                        'X-Tutorial-Email': userEmail,
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache'
                    }
                });
                
                const data = await response.json();
                
                if (response.ok && data.status === 'success') {
                    const isPro = data.subscription?.plan_code === 'pro';
                    const isActive = data.subscription?.is_active;
                    const hasUnlimitedAccess = data.feature_access?.access_levels?.can_access_unlimited_tutorials;
                    const hasDownloads = data.feature_access?.access_levels?.can_download_videos;
                    
                    if (isPro && isActive && hasUnlimitedAccess && hasDownloads) {
                        statusDiv.innerHTML = 'üéâ SUCCESS: Pro subscription is working perfectly!';
                        statusDiv.className = 'status-box status-success';
                        
                        resultDiv.innerHTML = `<h3>‚úÖ Pro Features Confirmed:</h3>
<ul>
<li>‚úÖ Plan: ${data.subscription.plan_code} (Pro)</li>
<li>‚úÖ Status: ${data.subscription.subscription_status} (Active)</li>
<li>‚úÖ Unlimited Tutorials: ${hasUnlimitedAccess ? 'YES' : 'NO'}</li>
<li>‚úÖ Video Downloads: ${hasDownloads ? 'YES' : 'NO'}</li>
<li>‚úÖ Live Workshops: ${data.feature_access?.access_levels?.can_access_live_workshops ? 'YES' : 'NO'}</li>
</ul>

<h4>üéØ What this means:</h4>
<ul>
<li>‚úÖ All videos should be unlocked in tutorials dashboard</li>
<li>‚úÖ Download buttons should be visible in tutorial viewer</li>
<li>‚úÖ Live workshops should be accessible</li>
<li>‚úÖ No more "upgrade to pro" messages</li>
</ul>

<p><strong>Clear your browser cache and refresh your React app to see the changes!</strong></p>`;
                    } else {
                        statusDiv.innerHTML = '‚ùå Pro subscription not properly configured';
                        statusDiv.className = 'status-box status-error';
                        resultDiv.innerHTML = `<h3>‚ùå Issues Found:</h3>
<ul>
<li>Plan: ${data.subscription?.plan_code} ${isPro ? '‚úÖ' : '‚ùå'}</li>
<li>Active: ${isActive ? '‚úÖ' : '‚ùå'}</li>
<li>Unlimited Access: ${hasUnlimitedAccess ? '‚úÖ' : '‚ùå'}</li>
<li>Downloads: ${hasDownloads ? '‚úÖ' : '‚ùå'}</li>
</ul>
<pre>${JSON.stringify(data, null, 2)}</pre>`;
                    }
                    resultDiv.style.display = 'block';
                } else {
                    statusDiv.innerHTML = '‚ùå API Error: ' + (data.message || 'Unknown error');
                    statusDiv.className = 'status-box status-error';
                    resultDiv.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                    resultDiv.style.display = 'block';
                }
            } catch (error) {
                statusDiv.innerHTML = '‚ùå Network error: ' + error.message;
                statusDiv.className = 'status-box status-error';
            }
        }
        
        async function testTutorialAccess() {
            const statusDiv = document.getElementById('status');
            const resultDiv = document.getElementById('result');
            
            statusDiv.innerHTML = 'üé• Testing tutorial access...';
            statusDiv.className = 'status-box status-error';
            statusDiv.style.display = 'block';
            
            try {
                // Test access to a paid tutorial
                const cacheBuster = '?cb=' + Date.now();
                const response = await fetch(`${API_BASE}/customer/check-tutorial-access.php${cacheBuster}&tutorial_id=1&email=${userEmail}`, {
                    method: 'GET',
                    headers: {
                        'X-Tutorials-Email': userEmail,
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache'
                    }
                });
                
                const data = await response.json();
                
                if (response.ok && data.status === 'success') {
                    if (data.has_access) {
                        statusDiv.innerHTML = 'üéâ SUCCESS: Tutorial access is working!';
                        statusDiv.className = 'status-box status-success';
                        
                        resultDiv.innerHTML = `<h3>‚úÖ Tutorial Access Confirmed:</h3>
<ul>
<li>‚úÖ Has Access: ${data.has_access ? 'YES' : 'NO'}</li>
<li>‚úÖ Access Type: ${data.access_type || data.reason}</li>
<li>‚úÖ Plan Code: ${data.plan_code}</li>
</ul>

<h4>üéØ What this means:</h4>
<ul>
<li>‚úÖ All paid tutorials should be unlocked</li>
<li>‚úÖ No lock icons on tutorial cards</li>
<li>‚úÖ Play buttons should be visible on all videos</li>
<li>‚úÖ Can watch any tutorial without purchase</li>
</ul>

<p><strong>Your Pro subscription is working perfectly!</strong></p>`;
                    } else {
                        statusDiv.innerHTML = '‚ùå Tutorial access denied';
                        statusDiv.className = 'status-box status-error';
                        resultDiv.innerHTML = `<h3>‚ùå Access Denied:</h3>
<p>Reason: ${data.reason}</p>
<pre>${JSON.stringify(data, null, 2)}</pre>`;
                    }
                    resultDiv.style.display = 'block';
                } else {
                    statusDiv.innerHTML = '‚ùå API Error: ' + (data.message || 'Unknown error');
                    statusDiv.className = 'status-box status-error';
                    resultDiv.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                    resultDiv.style.display = 'block';
                }
            } catch (error) {
                statusDiv.innerHTML = '‚ùå Network error: ' + error.message;
                statusDiv.className = 'status-box status-error';
            }
        }
        </script>
    </div>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
    <title>Quick Fix 500 Errors</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>üö® Quick Fix for 500 Errors</h1>
        <p class="text-muted">This will test and fix the APIs that are returning 500 errors</p>
        
        <div class="alert alert-info">
            <h5>What this tool does:</h5>
            <ul>
                <li>Tests the problematic APIs</li>
                <li>Shows detailed error information</li>
                <li>Provides working API alternatives</li>
                <li>Creates missing database tables</li>
            </ul>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <button class="btn btn-danger btn-lg w-100 mb-3" onclick="debugErrors()">
                    üîç Debug API Errors
                </button>
            </div>
            <div class="col-md-6">
                <button class="btn btn-success btn-lg w-100 mb-3" onclick="useWorkingAPIs()">
                    ‚úÖ Use Working APIs
                </button>
            </div>
        </div>
        
        <div id="results" class="mt-4"></div>
        
        <div class="mt-4">
            <h3>Manual Fix Instructions</h3>
            <div class="alert alert-warning">
                <p><strong>If you're still getting 500 errors, follow these steps:</strong></p>
                <ol>
                    <li><strong>Replace the API files:</strong>
                        <ul>
                            <li>Rename <code>tutorials.php</code> to <code>tutorials-old.php</code></li>
                            <li>Rename <code>tutorials-simple.php</code> to <code>tutorials.php</code></li>
                            <li>Do the same for <code>subscription-status.php</code> and <code>profile.php</code></li>
                        </ul>
                    </li>
                    <li><strong>Update your React component URLs:</strong>
                        <pre>// In TutorialsDashboard.jsx, change:
const response = await fetch('/my_little_thingz/backend/api/customer/tutorials.php');

// To:
const response = await fetch('/my_little_thingz/backend/api/customer/tutorials-simple.php');</pre>
                    </li>
                    <li><strong>Test the working APIs:</strong>
                        <ul>
                            <li><a href="/my_little_thingz/backend/api/customer/tutorials-simple.php" target="_blank">Test Tutorials API</a></li>
                            <li><a href="/my_little_thingz/backend/api/customer/subscription-status-simple.php?email=test@example.com" target="_blank">Test Subscription API</a></li>
                            <li><a href="/my_little_thingz/backend/api/customer/profile-simple.php" target="_blank">Test Profile API</a></li>
                        </ul>
                    </li>
                </ol>
            </div>
        </div>
    </div>

    <script>
    async function debugErrors() {
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = '<div class="alert alert-info">Running debug analysis...</div>';
        
        try {
            const response = await fetch('/my_little_thingz/backend/debug-api-errors.php');
            const html = await response.text();
            
            resultsDiv.innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <h5>üîç Debug Results</h5>
                    </div>
                    <div class="card-body">
                        ${html}
                    </div>
                </div>
            `;
        } catch (error) {
            resultsDiv.innerHTML = `
                <div class="alert alert-danger">
                    <strong>Debug Error:</strong> ${error.message}<br>
                    <small>Make sure your web server is running and accessible</small>
                </div>
            `;
        }
    }
    
    async function useWorkingAPIs() {
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = '<div class="alert alert-info">Testing working APIs...</div>';
        
        const tests = [
            {
                name: 'Tutorials API (Simple)',
                url: '/my_little_thingz/backend/api/customer/tutorials-simple.php',
                headers: { 'X-Tutorial-Email': 'test@example.com' }
            },
            {
                name: 'Subscription Status API (Simple)',
                url: '/my_little_thingz/backend/api/customer/subscription-status-simple.php?email=test@example.com'
            },
            {
                name: 'Profile API (Simple)',
                url: '/my_little_thingz/backend/api/customer/profile-simple.php',
                headers: { 'X-Tutorial-Email': 'test@example.com' }
            }
        ];
        
        let results = [];
        
        for (const test of tests) {
            try {
                const response = await fetch(test.url, {
                    method: 'GET',
                    headers: test.headers || {}
                });
                
                const data = await response.json();
                
                results.push({
                    name: test.name,
                    status: response.status,
                    success: response.ok && data.status === 'success',
                    data: data
                });
            } catch (error) {
                results.push({
                    name: test.name,
                    status: 0,
                    success: false,
                    error: error.message
                });
            }
        }
        
        const successCount = results.filter(r => r.success).length;
        const totalCount = results.length;
        
        resultsDiv.innerHTML = `
            <div class="card">
                <div class="card-header">
                    <h5>‚úÖ Working APIs Test Results: ${successCount}/${totalCount}</h5>
                </div>
                <div class="card-body">
                    ${results.map(result => `
                        <div class="mb-3">
                            <h6 class="${result.success ? 'text-success' : 'text-danger'}">
                                ${result.success ? '‚úÖ' : '‚ùå'} ${result.name}
                            </h6>
                            ${result.success ? 
                                `<pre class="bg-light p-2 small">${JSON.stringify(result.data, null, 2)}</pre>` :
                                `<div class="text-danger small">${result.error || 'Failed'}</div>`
                            }
                        </div>
                    `).join('')}
                    
                    ${successCount === totalCount ? `
                        <div class="alert alert-success">
                            <strong>üéâ All APIs are working!</strong><br>
                            You can now update your React components to use these working APIs.
                        </div>
                        <div class="alert alert-info">
                            <strong>Next Steps:</strong><br>
                            1. Update your TutorialsDashboard.jsx to use the -simple.php versions<br>
                            2. Or rename the -simple.php files to replace the original ones<br>
                            3. Your videos should now be visible!
                        </div>
                    ` : `
                        <div class="alert alert-warning">
                            Some APIs are still not working. Check the debug results above.
                        </div>
                    `}
                </div>
            </div>
        `;
    }
    </script>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
    <title>Find Real Custom Requests Tool</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .info { color: #3b82f6; }
        .warning { color: #f59e0b; }
        button { background: #3b82f6; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #2563eb; }
        button.danger { background: #ef4444; }
        button.danger:hover { background: #dc2626; }
        button.success { background: #10b981; }
        button.success:hover { background: #059669; }
        .request-card { border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; margin: 10px 0; }
        .real-request { background: #d1fae5; border-color: #10b981; }
        .sample-request { background: #fef3c7; border-color: #f59e0b; }
        .request-header { font-weight: bold; color: #1f2937; margin-bottom: 10px; }
        .request-details { color: #6b7280; font-size: 14px; }
        #output { background: #f8f9fa; padding: 15px; border-radius: 5px; margin: 15px 0; min-height: 200px; max-height: 600px; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #f8f9fa; }
        .real-row { background: #d1fae5; }
        .sample-row { background: #fef3c7; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Find Real Custom Requests Tool</h1>
        <p>This tool will help you identify and restore real customer requests while removing sample data.</p>
        
        <div>
            <button onclick="checkAllData()">1. Check All Data</button>
            <button onclick="identifyRealRequests()">2. Identify Real Requests</button>
            <button class="danger" onclick="removeSampleData()">3. Remove Sample Data</button>
            <button class="success" onclick="restoreRealData()">4. Restore Real Data</button>
            <button onclick="testFinalResult()">5. Test Final Result</button>
        </div>
        
        <div id="output">Click "1. Check All Data" to start analyzing your custom requests...</div>
    </div>

    <script>
        async function checkAllData() {
            document.getElementById('output').innerHTML = '<p class="info">üîÑ Checking all data sources...</p>';
            
            try {
                const response = await fetch('check-real-custom-requests.php');
                const html = await response.text();
                document.getElementById('output').innerHTML = html;
            } catch (error) {
                document.getElementById('output').innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }
        
        async function identifyRealRequests() {
            document.getElementById('output').innerHTML = '<p class="info">üîç Identifying real vs sample requests...</p>';
            
            try {
                const response = await fetch('api/admin/custom-requests-database-only.php?status=all');
                const data = await response.json();
                
                if (data.status === 'success') {
                    let html = '<h3>üìã Current Requests Analysis</h3>';
                    
                    const sampleEmails = [
                        'alice.johnson@email.com',
                        'michael.chen@email.com', 
                        'sarah.williams@email.com',
                        'robert.davis@email.com'
                    ];
                    
                    let realRequests = [];
                    let sampleRequests = [];
                    
                    data.requests.forEach(req => {
                        if (sampleEmails.includes(req.customer_email) || 
                            req.order_id.match(/CR-\d{8}-\d{3}/)) {
                            sampleRequests.push(req);
                        } else {
                            realRequests.push(req);
                        }
                    });
                    
                    html += `
                        <div class="success">
                            <h4>‚úÖ Analysis Complete</h4>
                            <p><strong>Real Customer Requests:</strong> ${realRequests.length}</p>
                            <p><strong>Sample/Test Data:</strong> ${sampleRequests.length}</p>
                        </div>
                    `;
                    
                    if (realRequests.length > 0) {
                        html += '<h4>üéØ Real Customer Requests:</h4>';
                        realRequests.forEach(req => {
                            html += `
                                <div class="request-card real-request">
                                    <div class="request-header">REAL: ${req.title}</div>
                                    <div class="request-details">
                                        <strong>Customer:</strong> ${req.customer_name}<br>
                                        <strong>Email:</strong> ${req.customer_email}<br>
                                        <strong>Order ID:</strong> ${req.order_id}<br>
                                        <strong>Status:</strong> ${req.status}<br>
                                        <strong>Created:</strong> ${req.created_at}
                                    </div>
                                </div>
                            `;
                        });
                    } else {
                        html += '<p class="warning">‚ö†Ô∏è No real customer requests found. All current data appears to be sample/test data.</p>';
                    }
                    
                    if (sampleRequests.length > 0) {
                        html += '<h4>üß™ Sample/Test Data (to be removed):</h4>';
                        sampleRequests.forEach(req => {
                            html += `
                                <div class="request-card sample-request">
                                    <div class="request-header">SAMPLE: ${req.title}</div>
                                    <div class="request-details">
                                        <strong>Customer:</strong> ${req.customer_name}<br>
                                        <strong>Email:</strong> ${req.customer_email}<br>
                                        <strong>Order ID:</strong> ${req.order_id}
                                    </div>
                                </div>
                            `;
                        });
                    }
                    
                    document.getElementById('output').innerHTML = html;
                } else {
                    document.getElementById('output').innerHTML = `<p class="error">‚ùå API Error: ${data.message}</p>`;
                }
            } catch (error) {
                document.getElementById('output').innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }
        
        async function removeSampleData() {
            if (!confirm('Are you sure you want to remove all sample data? This action cannot be undone.')) {
                return;
            }
            
            document.getElementById('output').innerHTML = '<p class="warning">üóëÔ∏è Removing sample data...</p>';
            
            try {
                const response = await fetch('restore-real-custom-requests.php');
                const html = await response.text();
                document.getElementById('output').innerHTML = html;
            } catch (error) {
                document.getElementById('output').innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }
        
        async function restoreRealData() {
            document.getElementById('output').innerHTML = '<p class="info">üîÑ Checking for real data in backups and other tables...</p>';
            
            // This will run the restore process
            try {
                const response = await fetch('restore-real-custom-requests.php');
                const html = await response.text();
                document.getElementById('output').innerHTML = html;
            } catch (error) {
                document.getElementById('output').innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }
        
        async function testFinalResult() {
            document.getElementById('output').innerHTML = '<p class="info">üß™ Testing final result...</p>';
            
            try {
                const response = await fetch('api/admin/custom-requests-database-only.php?status=all');
                const data = await response.json();
                
                if (data.status === 'success') {
                    let html = `
                        <div class="success">
                            <h3>‚úÖ Final Result</h3>
                            <p><strong>Total Real Requests:</strong> ${data.total_count}</p>
                            <p><strong>API Version:</strong> ${data.api_version}</p>
                            <p><strong>Message:</strong> ${data.message}</p>
                        </div>
                    `;
                    
                    if (data.requests && data.requests.length > 0) {
                        html += '<h4>üìã Your Real Custom Requests:</h4>';
                        data.requests.forEach(req => {
                            html += `
                                <div class="request-card real-request">
                                    <div class="request-header">${req.title}</div>
                                    <div class="request-details">
                                        <strong>Customer:</strong> ${req.customer_name} (${req.customer_email})<br>
                                        <strong>Phone:</strong> ${req.customer_phone || 'N/A'}<br>
                                        <strong>Status:</strong> ${req.status}<br>
                                        <strong>Description:</strong> ${req.description}<br>
                                        <strong>Requirements:</strong> ${req.requirements}<br>
                                        <strong>Budget:</strong> $${req.budget_min} - $${req.budget_max}<br>
                                        <strong>Deadline:</strong> ${req.deadline}<br>
                                        <strong>Created:</strong> ${req.created_at}
                                    </div>
                                </div>
                            `;
                        });
                        
                        html += `
                            <div class="success">
                                <h4>üéâ Success!</h4>
                                <p>Your admin dashboard will now show only real customer requests.</p>
                                <p><a href="../frontend/src/pages/AdminDashboard.jsx" target="_blank">Go to Admin Dashboard</a></p>
                            </div>
                        `;
                    } else {
                        html += `
                            <div class="warning">
                                <h4>‚ö†Ô∏è No Real Requests Found</h4>
                                <p>It appears you don't have any real customer requests yet. This could mean:</p>
                                <ul>
                                    <li>No customers have submitted custom requests yet</li>
                                    <li>The custom request form might not be working</li>
                                    <li>Real data might be in a different location</li>
                                </ul>
                                <p>Your admin dashboard will now show an empty list, which is correct if no real requests exist.</p>
                            </div>
                        `;
                    }
                    
                    document.getElementById('output').innerHTML = html;
                } else {
                    document.getElementById('output').innerHTML = `<p class="error">‚ùå API Error: ${data.message}</p>`;
                }
            } catch (error) {
                document.getElementById('output').innerHTML = `<p class="error">‚ùå Test Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
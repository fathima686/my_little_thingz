<!DOCTYPE html>
<html>
<head>
    <title>Test Frontend Integration</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .success { color: #10b981; font-weight: bold; }
        .error { color: #ef4444; font-weight: bold; }
        .info { color: #3b82f6; font-weight: bold; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; background: #3b82f6; color: white; }
        button:hover { background: #2563eb; }
        .result { margin: 15px 0; padding: 15px; border-radius: 5px; background: #f8f9fa; border-left: 4px solid #e5e7eb; }
        .result.success { background: #f0fdf4; border-left-color: #10b981; }
        .result.error { background: #fef2f2; border-left-color: #ef4444; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; max-height: 300px; overflow-y: auto; }
        .step { background: #e0f2fe; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .live-access-demo { background: #f0fdf4; border: 2px solid #10b981; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .access-denied-demo { background: #fef2f2; border: 2px solid #ef4444; padding: 20px; border-radius: 8px; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Frontend Integration</h1>
        <p>This simulates exactly what your React app does to check live sessions access.</p>
        
        <div class="step">
            <h2 class="info">Step 1: Get Subscription Status (Like React App)</h2>
            <button onclick="getSubscriptionStatus()">Get Subscription Status</button>
            <div id="subscriptionResult"></div>
        </div>
        
        <div class="step">
            <h2 class="info">Step 2: Check Live Workshops Access (React Logic)</h2>
            <button onclick="checkLiveAccess()">Check Live Access (React Logic)</button>
            <div id="accessResult"></div>
        </div>
        
        <div class="step">
            <h2 class="info">Step 3: Get Live Sessions (Like React App)</h2>
            <button onclick="getLiveSessions()">Get Live Sessions</button>
            <div id="sessionsResult"></div>
        </div>
        
        <div class="step">
            <h2 class="info">Step 4: Complete Frontend Simulation</h2>
            <button onclick="simulateReactApp()">Simulate Complete React App Flow</button>
            <div id="simulationResult"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost/my_little_thingz/backend/api';
        const userEmail = 'soudhame52@gmail.com';
        let subscriptionStatus = null;

        function getSubscriptionStatus() {
            const resultDiv = document.getElementById('subscriptionResult');
            resultDiv.innerHTML = '<div class="result">Getting subscription status...</div>';
            
            fetch('api/customer/profile.php?email=' + encodeURIComponent(userEmail))
            .then(response => response.json())
            .then(data => {
                subscriptionStatus = data; // Store for later use
                
                const hasFeatureAccess = data.feature_access?.access_levels?.can_access_live_workshops;
                const statusClass = hasFeatureAccess ? 'success' : 'error';
                const statusText = hasFeatureAccess ? 'YES ‚úÖ' : 'NO ‚ùå';
                
                resultDiv.innerHTML = `
                    <div class="result ${statusClass}">
                        <strong>Subscription Status Retrieved!</strong><br>
                        Plan: ${data.subscription?.plan_code || 'unknown'}<br>
                        Pro User: ${data.stats?.is_pro_user ? 'YES' : 'NO'}<br>
                        Can Access Live Workshops: ${statusText}
                    </div>
                    <details>
                        <summary>Full Response (Click to expand)</summary>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </details>
                `;
            })
            .catch(error => {
                resultDiv.innerHTML = '<div class="result error">‚ùå Error: ' + error.message + '</div>';
            });
        }

        function checkLiveAccess() {
            const resultDiv = document.getElementById('accessResult');
            
            if (!subscriptionStatus) {
                resultDiv.innerHTML = '<div class="result error">‚ùå Please get subscription status first</div>';
                return;
            }
            
            // This is EXACTLY what your React app does
            const canAccessLiveWorkshops = () => {
                return subscriptionStatus?.feature_access?.access_levels?.can_access_live_workshops || false;
            };
            
            const hasAccess = canAccessLiveWorkshops();
            
            if (hasAccess) {
                resultDiv.innerHTML = `
                    <div class="live-access-demo">
                        <h3>üéâ Live Workshops Unlocked!</h3>
                        <p>Your React app would show the live sessions interface here.</p>
                        <p><strong>Access Check Result:</strong> ‚úÖ GRANTED</p>
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="access-denied-demo">
                        <h3>üîí Live Workshops - Pro Feature</h3>
                        <p>Live workshops and mentorship sessions are available exclusively for Pro subscribers.</p>
                        <p><strong>Access Check Result:</strong> ‚ùå DENIED</p>
                        <p>Current Plan: <strong>${subscriptionStatus?.subscription?.plan_code || 'Basic'}</strong></p>
                    </div>
                `;
            }
        }

        function getLiveSessions() {
            const resultDiv = document.getElementById('sessionsResult');
            resultDiv.innerHTML = '<div class="result">Getting live sessions...</div>';
            
            // Test both APIs
            Promise.all([
                fetch('api/customer/live-sessions.php', {
                    headers: { 'X-Tutorial-Email': userEmail }
                }).then(r => r.json()).catch(e => ({ error: e.message, api: 'original' })),
                
                fetch('api/customer/live-sessions-simple-fixed.php', {
                    headers: { 'X-Tutorial-Email': userEmail }
                }).then(r => r.json()).catch(e => ({ error: e.message, api: 'fixed' }))
            ])
            .then(([originalAPI, fixedAPI]) => {
                let html = '<h3>API Comparison:</h3>';
                
                // Original API result
                html += '<h4>Original API (live-sessions.php):</h4>';
                if (originalAPI.status === 'success') {
                    html += '<div class="result success">‚úÖ Success: ' + originalAPI.sessions.length + ' sessions</div>';
                } else {
                    html += '<div class="result error">‚ùå ' + (originalAPI.message || originalAPI.error || 'Failed') + '</div>';
                }
                
                // Fixed API result
                html += '<h4>Fixed API (live-sessions-simple-fixed.php):</h4>';
                if (fixedAPI.status === 'success') {
                    html += '<div class="result success">‚úÖ Success: ' + fixedAPI.sessions.length + ' sessions</div>';
                } else {
                    html += '<div class="result error">‚ùå ' + (fixedAPI.message || fixedAPI.error || 'Failed') + '</div>';
                }
                
                html += '<details><summary>Full API Responses</summary>';
                html += '<h5>Original API:</h5><pre>' + JSON.stringify(originalAPI, null, 2) + '</pre>';
                html += '<h5>Fixed API:</h5><pre>' + JSON.stringify(fixedAPI, null, 2) + '</pre>';
                html += '</details>';
                
                resultDiv.innerHTML = html;
            });
        }

        function simulateReactApp() {
            const resultDiv = document.getElementById('simulationResult');
            resultDiv.innerHTML = '<div class="result">Simulating complete React app flow...</div>';
            
            // Step 1: Get subscription status
            fetch('api/customer/profile.php?email=' + encodeURIComponent(userEmail))
            .then(response => response.json())
            .then(profileData => {
                subscriptionStatus = profileData;
                
                // Step 2: Check access (React logic)
                const canAccessLiveWorkshops = () => {
                    return subscriptionStatus?.feature_access?.access_levels?.can_access_live_workshops || false;
                };
                
                const hasAccess = canAccessLiveWorkshops();
                
                let html = '<h3>üéØ Complete React App Simulation</h3>';
                html += '<div class="result success">‚úÖ Step 1: Profile loaded</div>';
                html += '<div class="result ' + (hasAccess ? 'success' : 'error') + '">Step 2: Access check - ' + (hasAccess ? 'GRANTED ‚úÖ' : 'DENIED ‚ùå') + '</div>';
                
                if (hasAccess) {
                    // Step 3: Load live sessions
                    return fetch('api/customer/live-sessions-simple-fixed.php', {
                        headers: { 'X-Tutorial-Email': userEmail }
                    })
                    .then(response => response.json())
                    .then(sessionsData => {
                        if (sessionsData.status === 'success') {
                            html += '<div class="result success">‚úÖ Step 3: Live sessions loaded (' + sessionsData.sessions.length + ' sessions)</div>';
                            html += '<div class="live-access-demo">';
                            html += '<h4>üéâ Your React App Would Show:</h4>';
                            html += '<ul>';
                            sessionsData.sessions.forEach(session => {
                                html += '<li><strong>' + session.title + '</strong> - ' + session.scheduled_date + ' at ' + session.scheduled_time + '</li>';
                            });
                            html += '</ul>';
                            html += '</div>';
                        } else {
                            html += '<div class="result error">‚ùå Step 3: Live sessions failed - ' + sessionsData.message + '</div>';
                        }
                        
                        resultDiv.innerHTML = html;
                    });
                } else {
                    html += '<div class="result error">‚ùå Step 3: Skipped (no access)</div>';
                    html += '<div class="access-denied-demo">';
                    html += '<h4>üîí Your React App Would Show:</h4>';
                    html += '<p>Live Workshops - Pro Feature</p>';
                    html += '<p>Current Plan: <strong>' + (profileData.subscription?.plan_code || 'Basic') + '</strong></p>';
                    html += '<button>Upgrade to Pro</button>';
                    html += '</div>';
                    
                    resultDiv.innerHTML = html;
                }
            })
            .catch(error => {
                resultDiv.innerHTML = '<div class="result error">‚ùå Simulation failed: ' + error.message + '</div>';
            });
        }
    </script>
</body>
</html>